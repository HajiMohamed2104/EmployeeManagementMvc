@model IEnumerable<WebApplication1.DTOs.EmployeeDto>
@{
    ViewData["Title"] = "Employees";
}

<div class="employee-management-container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="page-title">
                        <i class="fas fa-users"></i> Employee Management
                    </h1>
                    <p class="text-muted">Manage your organization's workforce</p>
                </div>
                <div class="page-actions">
                    <a asp-action="Create" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Employee
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Search and Filter Section -->
    <div class="card filter-card mb-4">
        <div class="card-header">
            <h5><i class="fas fa-search"></i> Search and Filter Employees</h5>
        </div>
        <div class="card-body">
            <form asp-action="Index" method="get" class="row g-3">
                <div class="col-md-3">
                    <label for="searchString" class="form-label">
                        <i class="fas fa-search"></i> Search
                    </label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchString" name="searchString"
                               value="@ViewBag.CurrentFilter" placeholder="Search by name, email...">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <label for="departmentFilter" class="form-label">
                        <i class="fas fa-building"></i> Department
                    </label>
                    <select class="form-select" id="departmentFilter" name="departmentFilter">
                        <option value="">All Departments</option>
                        @if (ViewBag.Departments != null)
                        {
                            @foreach (var dept in ViewBag.Departments)
                            {
                                <option value="@dept.Text" selected="@(dept.Text == ViewBag.DepartmentFilter)">@dept.Text</option>
                            }
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="minSalary" class="form-label">
                        <i class="fas fa-dollar-sign"></i> Min Salary
                    </label>
                    <input type="number" class="form-control" id="minSalary" name="minSalary"
                           value="@ViewBag.MinSalary" placeholder="0">
                </div>
                <div class="col-md-2">
                    <label for="maxSalary" class="form-label">
                        <i class="fas fa-dollar-sign"></i> Max Salary
                    </label>
                    <input type="number" class="form-control" id="maxSalary" name="maxSalary"
                           value="@ViewBag.MaxSalary" placeholder="100000">
                </div>
                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                        <a asp-action="Index" class="btn btn-outline-secondary">
                            <i class="fas fa-times"></i> Clear
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stats-mini-card">
                <div class="stats-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stats-info">
                    <h4>@(Model?.Count() ?? 0)</h4>
                    <p>Total Employees</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-mini-card">
                <div class="stats-icon">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stats-info">
                    <h4>@(Model?.Count(e => e.IsActive) ?? 0)</h4>
                    <p>Active</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-mini-card">
                <div class="stats-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="stats-info">
                    <h4>@(ViewBag.DepartmentCount ?? 0)</h4>
                    <p>Departments</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-mini-card">
                <div class="stats-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div class="stats-info">
                    <a asp-action="Statistics" class="stats-link">
                        <h4><i class="fas fa-arrow-right"></i></h4>
                        <p>View Stats</p>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Table -->
    <div class="card employee-table-card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="fas fa-list"></i> Employee List</h5>
            <div class="table-actions">
                <button class="btn btn-sm btn-outline-secondary" id="toggleView">
                    <i class="fas fa-th"></i> Card View
                </button>
            </div>
        </div>
        <div class="card-body">
            @if (Model != null && Model.Any())
            {
                <!-- Table View -->
                <div id="tableView" class="table-view">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-id-badge"></i> Employee #</th>
                                    <th><i class="fas fa-user"></i> Name</th>
                                    <th><i class="fas fa-envelope"></i> Email</th>
                                    <th><i class="fas fa-building"></i> Department</th>
                                    <th><i class="fas fa-user-tie"></i> Manager</th>
                                    <th><i class="fas fa-briefcase"></i> Position</th>
                                    <th><i class="fas fa-dollar-sign"></i> Salary</th>
                                    <th><i class="fas fa-circle"></i> Status</th>
                                    <th><i class="fas fa-cogs"></i> Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var employee in Model)
                                {
                                    <tr class="employee-row" data-employee-id="@employee.Id">
                                        <td>
                                            <span class="employee-number">@employee.EmployeeNumber</span>
                                        </td>
                                        <td>
                                            <div class="employee-info">
                                                <strong class="employee-name">@employee.FullName</strong>
                                                <small class="text-muted">Age: @employee.Age</small>
                                            </div>
                                        </td>
                                        <td>
                                            <a href="mailto:@employee.Email" class="email-link">@employee.Email</a>
                                        </td>
                                        <td>
                                            <span class="department-badge">@employee.DepartmentName</span>
                                        </td>
                                        <td>
                                            <span class="manager-badge">@employee.ManagerName</span>
                                        </td>
                                        <td>@employee.Position</td>
                                        <td>
                                            <div class="salary-info">
                                                <span class="monthly-salary">@employee.Salary.ToString("C")</span>
                                                <small class="text-muted annual-salary">Annual: @employee.AnnualSalary.ToString("C")</small>
                                            </div>
                                        </td>
                                        <td>
                                            @if (employee.IsActive)
                                            {
                                                <span class="badge bg-success status-active">
                                                    <i class="fas fa-check-circle"></i> Active
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary status-inactive">
                                                    <i class="fas fa-pause-circle"></i> Inactive
                                                </span>
                                            }
                                        </td>
                                        <td>
                                            <div class="action-buttons">
                                                <a asp-action="Details" asp-route-id="@employee.Id"
                                                    class="btn btn-sm btn-outline-primary action-btn" title="View Details">
                                                     <i class="fas fa-eye"></i>
                                                 </a>
                                                 <a asp-action="Edit" asp-route-id="@employee.Id"
                                                    class="btn btn-sm btn-outline-warning action-btn" title="Edit">
                                                     <i class="fas fa-edit"></i>
                                                 </a>
                                                 <a asp-action="Delete" asp-route-id="@employee.Id"
                                                    class="btn btn-sm btn-outline-danger action-btn delete-btn" title="Delete">
                                                     <i class="fas fa-trash"></i>
                                                 </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Card View -->
                <div id="cardView" class="card-view" style="display: none;">
                    <div class="row">
                        @foreach (var employee in Model)
                        {
                            <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                                <div class="employee-card">
                                    <div class="card-header">
                                        <div class="employee-avatar">
                                            <i class="fas fa-user-circle"></i>
                                        </div>
                                        @if (employee.IsActive)
                                        {
                                            <span class="status-indicator active"></span>
                                        }
                                        else
                                        {
                                            <span class="status-indicator inactive"></span>
                                        }
                                    </div>
                                    <div class="card-body">
                                        <h6 class="employee-name">@employee.FullName</h6>
                                        <p class="employee-number">@employee.EmployeeNumber</p>
                                        <p class="employee-email">
                                            <i class="fas fa-envelope"></i> @employee.Email
                                        </p>
                                        <p class="employee-dept">
                                            <i class="fas fa-building"></i> @employee.DepartmentName
                                        </p>
                                        <p class="employee-manager">
                                            <i class="fas fa-user-tie"></i> @employee.ManagerName
                                        </p>
                                        <p class="employee-position">
                                            <i class="fas fa-briefcase"></i> @employee.Position
                                        </p>
                                        <p class="employee-salary">
                                            <i class="fas fa-dollar-sign"></i> @employee.Salary.ToString("C")
                                        </p>
                                    </div>
                                    <div class="card-footer">
                                        <div class="btn-group w-100">
                                            <a asp-action="Details" asp-route-id="@employee.Id" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a asp-action="Edit" asp-route-id="@employee.Id" class="btn btn-sm btn-outline-warning">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a asp-action="Delete" asp-route-id="@employee.Id" class="btn btn-sm btn-outline-danger">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4>No employees found</h4>
                    <p class="text-muted">No employees match your current search criteria.</p>
                    <a asp-action="Create" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add First Employee
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<style>
.page-title {
    color: var(--dark-color);
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.page-title i {
    color: var(--primary-color);
    margin-right: 0.5rem;
}

.filter-card .card-header {
    background: linear-gradient(135deg, var(--secondary-color), #0891b2);
    color: white;
}

.filter-card .input-group-text {
    background: var(--gray-100);
    border-color: var(--gray-200);
}

.stats-mini-card {
    background: white;
    border-radius: 0.75rem;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border: 1px solid var(--gray-200);
    transition: all 0.3s ease;
    text-align: center;
}

.stats-mini-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.stats-icon {
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin: 0 auto 1rem;
}

.stats-info h4 {
    color: var(--dark-color);
    font-weight: 700;
    margin-bottom: 0.25rem;
}

.stats-info p {
    color: var(--gray-600);
    font-size: 0.9rem;
    margin: 0;
}

.stats-link {
    text-decoration: none;
    color: inherit;
}

.stats-link:hover {
    color: var(--primary-color);
}

.employee-table-card .card-header {
    background: linear-gradient(135deg, var(--dark-color), var(--gray-800));
    color: white;
}

.table th {
    background: linear-gradient(135deg, var(--gray-800), var(--gray-700));
    color: white;
    border: none;
    font-weight: 600;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 10;
}

.table th i {
    margin-right: 0.5rem;
    opacity: 0.8;
}

.employee-row {
    transition: all 0.2s ease;
}

.employee-row:hover {
    background: var(--gray-50);
    transform: scale(1.01);
}

.employee-info strong {
    color: var(--dark-color);
}

.employee-number {
    font-family: 'Courier New', monospace;
    font-weight: 600;
    color: var(--primary-color);
}

.email-link {
    color: var(--primary-color);
    text-decoration: none;
}

.email-link:hover {
    text-decoration: underline;
}

.department-badge {
    background: var(--gray-100);
    color: var(--gray-700);
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.8rem;
    font-weight: 500;
}

.manager-badge {
    background: var(--primary-light);
    color: var(--primary-dark);
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.8rem;
    font-weight: 500;
}

.salary-info .monthly-salary {
    font-weight: 600;
    color: var(--success-color);
}

.annual-salary {
    display: block;
    margin-top: 0.25rem;
    font-size: 0.8rem;
}

.action-buttons {
    display: flex;
    gap: 0.25rem;
}

.action-btn {
    padding: 0.375rem 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.employee-card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid var(--gray-200);
}

.employee-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.employee-card .card-header {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    color: white;
    padding: 1.5rem;
    position: relative;
    text-align: center;
}

.employee-avatar {
    font-size: 3rem;
    opacity: 0.9;
}

.status-indicator {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 1rem;
    height: 1rem;
    border-radius: 50%;
    border: 2px solid white;
}

.status-indicator.active {
    background: var(--success-color);
}

.status-indicator.inactive {
    background: var(--gray-400);
}

.employee-card .card-body {
    padding: 1.5rem;
}

.employee-card .employee-name {
    color: var(--dark-color);
    font-weight: 600;
    margin-bottom: 1rem;
}

.employee-card p {
    margin-bottom: 0.75rem;
    font-size: 0.9rem;
}

.employee-manager {
    color: var(--primary-color);
    font-weight: 500;
}

.employee-card .card-footer {
    background: var(--gray-50);
    border-top: 1px solid var(--gray-200);
    padding: 1rem;
}

.empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--gray-500);
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.table-row-hover {
    background: var(--gray-50) !important;
}
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            // View toggle functionality
            $('#toggleView').on('click', function() {
                const tableView = $('#tableView');
                const cardView = $('#cardView');
                const icon = $(this).find('i');

                if (tableView.is(':visible')) {
                    tableView.fadeOut(300, function() {
                        cardView.fadeIn(300);
                        icon.removeClass('fa-th').addClass('fa-list');
                        $('#toggleView').html('<i class="fas fa-list"></i> Table View');
                    });
                } else {
                    cardView.fadeOut(300, function() {
                        tableView.fadeIn(300);
                        icon.removeClass('fa-list').addClass('fa-th');
                        $('#toggleView').html('<i class="fas fa-th"></i> Card View');
                    });
                }
            });

            // Enhanced delete confirmation
            $('.delete-btn').on('click', function(e) {
                e.preventDefault();
                const href = $(this).attr('href');
                const employeeName = $(this).closest('tr').find('.employee-name').text() ||
                                    $(this).closest('.employee-card').find('.employee-name').text();

                Swal.fire({
                    title: 'Delete Employee?',
                    text: `Are you sure you want to delete ${employeeName}? This action cannot be undone.`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete',
                    cancelButtonText: 'Cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = href;
                    }
                });
            });

            // Row hover effects
            $('.employee-row').hover(
                function() {
                    $(this).addClass('table-row-hover');
                },
                function() {
                    $(this).removeClass('table-row-hover');
                }
            );

            // Search highlight
            const urlParams = new URLSearchParams(window.location.search);
            const searchTerm = urlParams.get('searchString');
            if (searchTerm) {
                highlightText(searchTerm);
            }

            function highlightText(term) {
                const regex = new RegExp(`(${term})`, 'gi');
                $('.employee-name, .email-link, .department-badge').each(function() {
                    $(this).html($(this).html().replace(regex, '<mark>$1</mark>'));
                });
            }

            // Filter form enhancement
            $('#searchString, #departmentFilter, #minSalary, #maxSalary').on('input change', function() {
                // Debounce the filter application
                clearTimeout(window.filterTimeout);
                window.filterTimeout = setTimeout(function() {
                    // Optional: Add client-side filtering here if needed
                }, 300);
            });

            // Add loading animation to filter button
            $('form button[type="submit"]').on('click', function() {
                $(this).html('<i class="fas fa-spinner fa-spin"></i> Filtering...');
                setTimeout(() => {
                    $(this).html('<i class="fas fa-filter"></i> Filter');
                }, 1000);
            });
        });
    </script>
}